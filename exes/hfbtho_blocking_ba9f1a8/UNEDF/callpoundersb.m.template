global m nfev Fvals Xhist Fhist Deltahist delta % For unedf_f checkpointing
addpath('../src/poundersb');
addpath('../src/poundersb/minq5/');

% Unrelaxable bound constraints:
%Bl = [.15, -16.2, 220, 28, 40, .9, -Inf(1,6),0];
%Bu = [.17, -15.8, 260, 36, 100, 1.5, Inf(1,6),1];
% Scaling bounds:
%L = [.14 -17 170 27 30 .8 -100 -100 -350 -350 -120 -100 0];
%U = [.18 -15 270 37 70  2 -40  100 -150 -150 -50 50 1];


% SLy4 to UNEDF0 run bounds
Bl = [.15, -16.2, 190, 28, 40, .9, -Inf(1,6)];
Bu = [.17, -15.8, 230, 36, 100, 1.5, Inf(1,6)];
% Scaling bounds:
L = [.14 -17 170 27 30 .8 -100 -100 -350 -350 -120 -100];
U = [.18 -15 270 37 70  2 -40  100 -150 -150 -50 50];

May31 = [ 0.156335468786250     ,
	   -15.8000000000000     ,
	   239.796625405295     ,
	   29.1338130446455     ,
	   40.0000000000000     ,
	   1.07407104353461     ,
	   -46.8500752533332     ,
	   -112.843096676643     ,
	   -208.898883443043     ,
	   -230.120146682150     ,
	   -64.3080612628011     ,
	   -39.0680487007696     ,
	   -54.3487164611663     ,
	   -66.4830420871463]';

Unedf_0= [
0.1605260d0
-16.05590d0
 230.00d0
 30.54290d0
 45.08040d0
 0.90d0
 -55.26060d0 
-55.62260d0
-170.3740d0
-199.2020d0  
-79.53080d0
 45.63020d0
]';

Unedf_1ex = [
 0.158366731281203
 -15.8000000000000
  220.000000000000
  28.3839520550152
  40.0000000000000
  1.00187172237670
 -44.6016362024908
 -180.956465344078
 -187.468585444369
 -207.209421806994
 -74.3391307279475
 -38.8371791097226
   0.813550803208000
 ]'; %'

Unedf_1 = [0.158706769332587
-1.580000000000000e+01
2.200000000000000e+02
28.9867890577721
40.0047904804136
0.992423332283364
-45.1351310222373
-145.382167908057
-186.065399575124
-206.579593890106
-74.0263331764599
-35.6582611147917]';

Sept10 = [1.573271627906720e-01
-1.580000045559675e+01
2.259433942042815e+02
2.834833867251342e+01
4.000196346071991e+01
9.958725949551007e-01
-4.329009044786037e+01
-1.641379833453982e+02
-1.861922442386394e+02
-2.067464144793081e+02
-7.526087088410750e+01
-2.265282172839329e+01
6.391295354888793e-01]';

Nov3 = [0.158042843597177     
 -15.8000000000000     
  220.892296245991     
  28.3433165327449     
  40.0000000000000     
 0.996758486962823     
 -43.9851718073365     
 -176.678417913355     
 -186.600658308728     
 -206.775714231347     
 -75.0110335078297     
 -31.9151324790890     
  0.705456541605437]';

Dec10 = [ 0.158359574309490    
	  -15.8000000000000    
	   220.000000000000    
	   28.3854108202047    
	   40.0000000000000    
	   1.00200385605071    
	  -44.6106827286975    
	  -180.962649603617    
	  -187.516911735308 
	  -207.279288428149 
	  -74.3422162221059    
	  -38.8800752047768    
	    0.813301837182082]';

Dec15 = [ 
 0.158366731281203     
 -15.8000000000000     
  220.000000000000     
  28.3839520550152     
  40.0000000000000     
  1.00187172237670     
 -44.6016362024908     
 -180.956465344078     
 -187.468585444369     
 -207.209421806994     
 -74.3391307279475     
 -38.8371791097226     
   0.813550803208000]';     

Apr12=[
       0.156165754609156     ,
	-15.8000054833601     ,
	238.014542157844     ,
	29.5169059147792     ,
	41.3338876304921     ,
	1.05865124854390     ,
	-46.6421714438671     ,
	-109.561901219348     ,
	-203.112839778759     ,
	-227.307393236596     ,
	-61.2289654187872     ,
	-63.9360978092113     ,
	-73.3768296241191     ,
	-37.1158012867237    ]';

Apr17=[ 0.156214670302531,
 -15.800000000000001,
 237.930306157833996,
  29.523544772187201,
  41.313947313493898,
   1.058443404890510,
 -46.611153267797697,
-109.389131740311001,
-203.009497090221998,
-227.234305144018009,
 -61.306579470948598,
 -63.885235237385601,
 -73.238795699924097,
 -37.030657306923899]';

Apr20=[   0.156216297088237,
	   -15.800000000000001,
	   237.937435864257992,
	   29.522162154838700,
	   41.318717512456701,
	   1.058010550499220,
	   -46.590583464040598,
	   -109.364867809713999,
	   -202.986568535847994,
	   -227.229109346893011,
	   -61.282379968738603,
	   -63.910545645924302,
	   -73.175405057947003,
	   -37.034578948488502]';


Apr24s=[  0.156243124131103,
 -15.800000000000001,
 237.771673435342990,
  29.530238542015201,
  41.244477043464101,
   1.057816118441740,
 -46.554226852109302,
-108.829091583717002,
-202.980048839727999,
-227.152043774769993,
 -61.139640166588400,
 -63.708321801523702,
 -73.306194837943394,
 -36.556029074470104]';

May26 = [ 0.156300343990125,     
	   -15.8000000000000 ,    
	   240.046625405295   ,  
	   29.1285318548721    , 
	   40.0000000000000     ,
	   1.07295512307231     ,
	   -46.8105498423895    ,
	   -113.091641718713    ,
	   -208.834730109971,
	   -230.521157594048,
	   -64.2776851571739 , 
	   -38.4278836578246  ,
	   -54.8487164611663    , 
	  -67.3365954777396]';     

Sly4_hypercube= [0.48846891779333462
0.5139254292777018
0.59900964482603625
0.50043028150520075
0.39904378701153947
0.53295582414673193
0.38339661458333346
0.578285675625
0.459
0.459
0.39642857142857141
0.46166666666666667]'; %'

SLy4 = [0.159538756711733
-15.972149141444596
229.900964482603626
32.004302815052007
45.961751480461579
1.439546988976078
-76.996203124999993
15.657135124999999
-285.84
-285.84
-92.250000000000000
-30.750000000000000
]'; %'

Nov19 = [
0.160482257758333     
-16.0684717974746     
230.000000000000     
31.3412970627911     
54.2415053802476     
0.900000000000000     
-55.2312557975730     
-64.2009682777170     
-170.817921521882     
-197.742990856061     
-77.9298787843791     
27.4234892623725 ]'; %'

func = @unedf_f; % [f h] Handle so func(x) returns 1-by-m vector F
n = 12;         % [int] Dimension (number of continuous variables)
npmax = .5*(n+1)*(n+2);  % [int] Max # of interp. points (>n+1) (2*n+1)
nfmax = 250;    % [int] Max # of fun. evals done by pounders (>n+1) (100)
printf = true; % [log] 1 Indicates you want output to screen (1)
gtol = 1e-10;   % [dbl] Tolerance for 2-norm of model gradient (>0) (1e-4)
delta = .1;     % [dbl] Positive trust region radius (.1)
X0 = (Unedf_1-L)./(U-L);      % [dbl] [max(nfs,1)-by-n] Set of initial pts (zeros(1,n))
xind = 1;       % [int] Index of point in X0 at which to start from (1)
nfs = 0;        % [int] Number of f values (at X0) known in advance (0)
m = 132;        % [int] Number of residuals
F0 = [];        % [dbl] [nfs-by-m] Set of known function values  ([])
Low = (Bl-L)./(U-L); % [dbl] [1-by-n] Vector of lower bounds (-Inf(1,n))
Upp = (Bu-L)./(U-L); % [dbl] [1-by-n] Vector of upper bounds (Inf(1,n))

% Choose your subproblem solver:
global spsolver
spsolver=2;  %Arnold Neumaiers minq

%X0=X0(1:12);
%Low = Low(1:12);
%Upp = Upp(1:12);
npmax = (n+1)*(n+2)/2;

% Checkpointing initialization:
Fvals = zeros(nfmax,1); Xhist = zeros(nfmax,n); Fhist = zeros(nfmax,m);
Deltahist = zeros(nfmax,1); nfev = 0;

[X,F,flag,xkin] = ...
    pounders(func,X0,n,npmax,nfmax,gtol,delta,nfs,m,F0,xind,Low,Upp,printf);
save(['Poundersb_test'],'X','F','flag','xkin')
