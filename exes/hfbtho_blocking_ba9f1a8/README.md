# AXIAL DFT SOLVER IN CONFIGURATION SPACE #

## OVERVIEW ##

\theCode is an implementation of the nuclear energy density functional
theory (DFT), where the energy of the nucleus is obtained by integration over
space of some phenomenological energy density, which is itself a functional of
the intrinsic neutron and proton densities. In \theCode, the energy density
derives either from the zero-range Skyrme or finite range Gogny effective
two-body interaction. Nuclear superfluidity is treated at the
Hartree-Fock-Bogoliubov (HFB) approximation. In the case of Skyrme
functionals, particle number projection (after variation) is also available.
Axial symmetry of the nuclear shape and time-reversal invariance are built-in
symmetries.

The program expands the neutron and proton wave functions on the cylindrical
harmonic oscillator (HO) basis. Expansion coefficients are determined by block
diagonalization of the HFB matrix, which is defined as the functional
derivative of the energy with respect to the neutron and proton densities.
Since the HFB matrix depends on the densities, and therefore on its own
eigenfunctions, the problem to solve is highly non-linear and requires an
iterative method (self-consistency). Suitable constraints are used to obtain
states with specific configurations such as deformations or temperature.

## DOCUMENTATION ##

A HTML documentation of the code can be generated by using DoxyGen-1.8.6 or
higher (http://www.stack.nl/~dimitri/doxygen/manual/install.html). Type

       make doc

from the main directory . The file 'doc/html/index.html' corresponds to the
main page.


## THE SOLVER ##


### Building the code ###

\theCode requires a Fortran compiler, the GNU Makefile utility, and an
implementation of the standard Open Source libraries BLAS and LAPACK
(http://www.netlib.org/lapack)

You should first adapt the Makefile to your system. This includes:
  - Setting the variable *COMPILER* to one of the pre-defined values,
    *IFORT*, *GFORTRAN*, *CRAY*, *IBM*. This simply activates the relevant
    list of command-line flags for the requested compiler;
  - Setting *FORTRAN_MPI* to the executable name of your compiler. For
    example, for the GNU compiler, it could be *FORTRAN_MPI = gfortran.* If
    compiling in parallel mode using a standard MPI installation, it could
    be *FORTRAN_MPI = mpif90*, etc.
  - Choosing optimized or debug mode by setting the variable *DEBUG = FALSE*
    or *DEBUG = TRUE*, respectively. This choice changes the default compiler
    flags.

The Makefile included with the code is preset for the GNU compiler,
assumes 'gfortran' is the compiler executable and activates optimization.
It also builds the code by linking to existing BLAS and LAPACK libraries,
that are assumed to be available under the names libblas.a and liblapack.a
and be located in $HOME/local.

Additional options related to parallel execution are also available:
  - Multi-threading using OpenMP can be activated by setting *USE_OPENMP = 1*.
    See Notes at the end of this README file to avoid 'segmentation fault'
    error messages at runtime;
  - Distributed memory parallelism, i.e., MPI mode, can be activated by
    setting *USE_MPI = 1*. This option is used primarily to do large-scale
    calculations of nuclear properties, either in the ground-state (mass
    tables) or potential energy surfaces;

Refer to the instructions given in the Makefile itself for further
guidance.

Once the Makefile is set up, simply type

    make

to build the code.


### Running the code ###

In serial mode (*USE_MPI = 0*), running \theCode is done simply by

     ./hfbtho_main >& [output_file]

where *[output_file]* is an arbitrary file name containing the redirection
of the standard output and standard error. Note that the code opens the file
named *hfbtho_NAMELIST.dat* to set user-defined data. If this file is not
present, an error message will be returned.

In parallel mode, the code can be executed as

    mpirun -np 4 ./hfbtho_main >& [output_file]


### Notes ###

On Blue Gene and Blue Gene Q machines, the user should use the IBM
compiler and may want to also use the IBM scientific library ESSL. In
this case, the switch *SWITCH_ESSL* should be activated to
*SWITCH_ESSL = TRUE*.

When running the code on personal laptops and desktops with OpenMP
multi-threading (*USE_OPENMP = 1*), it may be necessary to set the
following environment variables (examples below are given for the
bash shell),

     export OMP_STACKSIZE=64M
     ulimit -s unlimited

This will ensure there is enough stack memory for each thread. The value
of OMP_STACKSIZE may have to be increased even further for large bases.
Without such instructions, the code may crash with a 'segmentation fault'
error message.


